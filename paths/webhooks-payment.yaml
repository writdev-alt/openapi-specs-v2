'/webhooks/payment':
  post:
    summary: 'Payment webhook endpoint'
    operationId: receivePaymentWebhook
    description: |
      This endpoint represents the webhook URL that WRPay will POST to when payment events occur.
      
      **Important**: This is not an endpoint you call. Instead, you configure your webhook URL in the merchant dashboard, and WRPay will send POST requests to your configured URL when payment events occur.
      
      ## Webhook Events
      
      The `receive_payment` event is triggered when a payment status changes to `pending` or `completed`.
      
      ## Security
      
      Each webhook request includes an `X-Signature` header containing an HMAC-SHA256 signature of the request body. You must verify this signature using your webhook secret to ensure the request is authentic.
      
      ## Response Requirements
      
      Your webhook endpoint must:
      - Return HTTP 200 status code within 10 seconds
      - Return a JSON response (can be empty: `{}`)
      - Handle duplicate webhook deliveries (idempotency)
    tags:
      - Webhooks
    requestBody:
      required: true
      description: 'Webhook payload containing payment event data'
      content:
        application/json:
          schema:
            type: object
            required:
              - event
              - data
              - message
              - status
              - timestamp
            properties:
              event:
                type: string
                description: 'Event type identifier (e.g., "receive_payment")'
                example: receive_payment
              data:
                type: object
                description: 'Event-specific data payload containing payment information'
                properties:
                  trxId:
                    type: string
                    description: 'Unique transaction identifier generated by the system'
                  trxReference:
                    type: string
                    nullable: true
                    description: "Merchant's transaction reference (if provided)"
                  referenceNumber:
                    type: string
                    nullable: true
                    description: 'Retrieval Reference Number from the payment gateway'
                  amount:
                    type: string
                    description: 'Payment amount as a decimal string'
                  currencyCode:
                    type: string
                    description: 'Currency code (e.g., "IDR")'
                  description:
                    type: string
                    nullable: true
                    description: 'Customer-facing description'
                  customerName:
                    type: string
                    nullable: true
                    description: "Customer's full name"
                  customerEmail:
                    type: string
                    nullable: true
                    description: "Customer's email address"
                  customerPhone:
                    type: string
                    nullable: true
                    description: "Customer's phone number"
                  merchantId:
                    type: integer
                    description: 'Merchant ID'
                  merchantName:
                    type: string
                    description: 'Merchant name'
                  paymentMethod:
                    type: string
                    description: 'Payment method used (e.g., "QRIS")'
                additionalProperties: true
              message:
                type: string
                description: 'Human-readable message describing the event'
              status:
                type: string
                description: 'Transaction status'
              timestamp:
                type: integer
                description: 'Unix timestamp when the event occurred'
          example:
            event: receive_payment
            data:
              trxId: TRX-2025.11.12-3QS4LURBQ6
              trxReference: ILONAPAY_69146275622d7
              referenceNumber: '1ittl5s63288'
              amount: '2000.00'
              currencyCode: IDR
              description: null
              customerName: null
              customerEmail: null
              customerPhone: null
              merchantId: 22
              merchantName: KPK79
              paymentMethod: QRIS
            message: Receive Payment via QRIS
            status: completed
            timestamp: 1762943651
    parameters:
      -
        in: header
        name: X-Signature
        required: true
        description: |
          HMAC-SHA256 signature of the request body, computed using your webhook secret.
          
          To verify:
          1. Get the raw request body
          2. Compute HMAC-SHA256 of the body using your webhook secret
          3. Compare with the value in this header
          
          If signatures don't match, reject the request with HTTP 401.
        schema:
          type: string
        example: 'sha256=abc123def456...'
    responses:
      200:
        description: |
          Webhook received and processed successfully.
          
          Your endpoint should return this status code to acknowledge receipt of the webhook.
          WRPay will retry the webhook if you don't return 200 within 10 seconds.
        content:
          application/json:
            schema:
              type: object
              properties:
                received:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: 'Webhook processed successfully'
      401:
        description: |
          Signature verification failed.
          
          Return this if the X-Signature header doesn't match the computed signature.
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: 'Invalid signature'
      500:
        description: |
          Internal server error processing the webhook.
          
          WRPay will retry the webhook if you return a 5xx status code.

