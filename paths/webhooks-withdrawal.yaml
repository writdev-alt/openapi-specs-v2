'/webhooks/withdrawal':
  post:
    summary: 'Withdrawal webhook endpoint'
    operationId: receiveWithdrawalWebhook
    description: |
      This endpoint represents the webhook URL that WRPay will POST to when withdrawal events occur.
      
      **Important**: This is not an endpoint you call. Instead, you configure your webhook URL in the merchant dashboard, and WRPay will send POST requests to your configured URL when withdrawal events occur.
      
      ## Webhook Events
      
      The `withdrawal` event is triggered when a withdrawal status changes (e.g., `awaiting_fi_process`, `awaiting_pg_process`, `completed`, `failed`, `refunded`).
      
      ## Security
      
      Each webhook request includes an `X-Signature` header containing an HMAC-SHA256 signature of the request body. You must verify this signature using your webhook secret to ensure the request is authentic.
      
      ## Response Requirements
      
      Your webhook endpoint must:
      - Return HTTP 200 status code within 10 seconds
      - Return a JSON response (can be empty: `{}`)
      - Handle duplicate webhook deliveries (idempotency)
    tags:
      - Webhooks
    requestBody:
      required: true
      description: 'Webhook payload containing withdrawal event data'
      content:
        application/json:
          schema:
            type: object
            required:
              - event
              - data
              - message
              - status
              - timestamp
            properties:
              event:
                type: string
                description: 'Event type identifier (e.g., "withdrawal")'
                example: withdrawal
              data:
                type: object
                description: 'Event-specific data payload containing withdrawal information'
                properties:
                  trxId:
                    type: string
                    description: 'Unique transaction identifier generated by the system'
                  trxReference:
                    type: string
                    nullable: true
                    description: "Merchant's transaction reference (if provided)"
                  amount:
                    type: string
                    description: 'Original withdrawal amount as a decimal string'
                  netAmount:
                    type: string
                    description: 'Net amount after fees as a decimal string'
                  payableAmount:
                    type: string
                    description: 'Final amount to be paid out as a decimal string'
                  currencyCode:
                    type: string
                    description: 'Currency code (e.g., "IDR")'
                  status:
                    type: string
                    description: 'Withdrawal status (e.g., "pending", "completed", "failed")'
                  description:
                    type: string
                    nullable: true
                    description: 'Description of the withdrawal'
                  merchantId:
                    type: integer
                    description: 'Merchant ID'
                  merchantName:
                    type: string
                    nullable: true
                    description: 'Merchant business name'
                  withdrawalMethod:
                    type: string
                    description: 'Withdrawal method used (e.g., "Bank Transfer")'
                  accountName:
                    type: string
                    nullable: true
                    description: 'Name of the withdrawal account'
                  accountHolderName:
                    type: string
                    nullable: true
                    description: "Account holder's full name"
                  accountBankName:
                    type: string
                    nullable: true
                    description: 'Bank name for the withdrawal account'
                  accountNumber:
                    type: string
                    nullable: true
                    description: 'Account number for withdrawal'
                  accountBankCode:
                    type: string
                    nullable: true
                    description: 'Bank code (e.g., "014" for BCA)'
                  trxFee:
                    type: string
                    description: 'Transaction fee charged as a decimal string'
                  remarks:
                    type: string
                    nullable: true
                    description: 'Additional remarks or notes'
                  environment:
                    type: string
                    description: 'Environment where the transaction occurred ("production" or "sandbox")'
                  isSandbox:
                    type: boolean
                    description: 'Whether the transaction is in sandbox mode'
                additionalProperties: true
              message:
                type: string
                description: 'Human-readable message describing the event'
              status:
                type: string
                description: 'Transaction status'
              timestamp:
                type: integer
                description: 'Unix timestamp when the event occurred'
          example:
            event: withdrawal
            data:
              trxId: TRX-2025.01.15-ABC123XYZ
              trxReference: WD-2025-0001
              amount: '250000.00'
              netAmount: '245000.00'
              payableAmount: '245000.00'
              currencyCode: IDR
              status: completed
              description: Withdrawal to Bank BCA
              merchantId: 22
              merchantName: KPK79
              withdrawalMethod: Bank Transfer
              accountName: Bank BCA
              accountHolderName: Budi Santoso
              accountBankName: Bank Central Asia
              accountNumber: '1234567890'
              accountBankCode: '014'
              trxFee: '5000.00'
              remarks: Withdrawal processed successfully
              environment: production
              isSandbox: false
            message: Withdrawal completed successfully
            status: completed
            timestamp: 1762943651
    parameters:
      -
        in: header
        name: X-Signature
        required: true
        description: |
          HMAC-SHA256 signature of the request body, computed using your webhook secret.
          
          To verify:
          1. Get the raw request body
          2. Compute HMAC-SHA256 of the body using your webhook secret
          3. Compare with the value in this header
          
          If signatures don't match, reject the request with HTTP 401.
        schema:
          type: string
        example: 'sha256=abc123def456...'
    responses:
      200:
        description: |
          Webhook received and processed successfully.
          
          Your endpoint should return this status code to acknowledge receipt of the webhook.
          WRPay will retry the webhook if you don't return 200 within 10 seconds.
        content:
          application/json:
            schema:
              type: object
              properties:
                received:
                  type: boolean
                  example: true
                message:
                  type: string
                  example: 'Webhook processed successfully'
      401:
        description: |
          Signature verification failed.
          
          Return this if the X-Signature header doesn't match the computed signature.
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: 'Invalid signature'
      500:
        description: |
          Internal server error processing the webhook.
          
          WRPay will retry the webhook if you return a 5xx status code.

