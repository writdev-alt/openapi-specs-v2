# WRPay API OpenAPI Specification

[![OpenAPI](https://img.shields.io/badge/OpenAPI-3.0.3-green.svg)](https://www.openapis.org/)
[![License](https://img.shields.io/badge/License-Proprietary-red.svg)](https://ilonapay.com/terms)
[![Documentation](https://img.shields.io/badge/docs-available-blue.svg)](https://github.com/writdev-alt/openapi-specs-v2)

This repository contains the OpenAPI specification for the WRPay API, split into multiple files for better maintainability.

## Structure

```
.
├── openapi.yaml          # Main OpenAPI file (generated by npm run merge, managed by Redocly)
├── redocly.yaml          # Redocly configuration
├── package.json          # NPM scripts and dependencies
├── bundled.yaml          # Generated bundled file (created by npm run bundle)
├── components/
│   ├── security.yaml     # Security schemes
│   ├── responses.yaml    # Common response definitions
│   └── schemas.yaml      # Common schema definitions
├── paths/
│   ├── payments.yaml           # Payment endpoints
│   ├── transactions.yaml       # Transaction endpoints
│   ├── wallets.yaml            # Wallet endpoints
│   ├── payment-support.yaml    # Payment support endpoints (banks, wallets, virtual accounts)
│   ├── withdraw-accounts.yaml  # Withdraw account endpoints
│   └── withdrawals.yaml        # Withdrawal endpoints
└── reference/
    ├── common-responses.md     # Common response patterns
    ├── error-codes.md          # Error code reference
    ├── transaction-statuses.md # Transaction status documentation
    ├── webhooks.md             # Webhook documentation
    └── RESPONSE_CODES.md       # Complete response codes reference
```

## Setup

Install dependencies:

```bash
npm install
```

## Usage

### Merge Paths

Merge all path files into the main `openapi.yaml` file:

```bash
npm run merge
```

This creates `openapi.yaml` with all paths merged and components referenced. Redocly will resolve component references during bundling.

### Bundle with Redocly

Bundle the OpenAPI specification into a single file (automatically merges paths first):

```bash
npm run bundle
```

This creates `bundled.yaml` which contains the complete, bundled OpenAPI specification with all references resolved.

### Lint

Lint the OpenAPI specification:

```bash
npm run lint
```

### Preview Documentation

Preview the API documentation locally:

```bash
npm run preview
```

**Note**: The `sidebars.yaml` file is used by Redocly Portal (hosted platform) for navigation. When using `redocly build-docs` for standalone HTML builds, only the OpenAPI spec is rendered. Markdown reference files (in `reference/`) are not included in standalone builds. To use sidebars and markdown files, you need to use Redocly Portal or embed the content into the OpenAPI spec.

### Build for Production

Build static HTML documentation:

```bash
npm run build
```

This creates a `dist/` directory with:
- `index.html` - Interactive API documentation
- `bundled.yaml` - Complete OpenAPI specification
- Logo and favicon assets

## Deployment

### Deploy to GitHub Pages

This repository includes a GitHub Actions workflow (`.github/workflows/deploy.yml`) that automatically builds and deploys to GitHub Pages on every push to the `main` branch.

**Setup:**

1. **Enable GitHub Pages in repository settings:**
   - Go to your GitHub repository → Settings → Pages
   - Under "Source", select "GitHub Actions"

2. **Push to main:**
   - The workflow will automatically:
     - Build and lint the OpenAPI specification
     - Deploy to GitHub Pages on push to `main` branch
     - The site will be available at `https://github.com/writdev-alt/openapi-specs-v2` or your custom domain

**What happens during deployment:**
- Runs `npm run build` which:
  1. Merges all path files into `openapi.yaml`
  2. Bundles the OpenAPI spec into `bundled.yaml`
  3. Generates favicons in multiple sizes
  4. Generates static HTML documentation in `dist/`
  5. Creates `.nojekyll` file to prevent Jekyll processing
- Deploys the `dist/` directory to GitHub Pages

### Manual Deployment

You can also manually deploy the `dist/` folder to any static hosting service:
- Netlify
- AWS S3 + CloudFront
- Any static file hosting

## Workflow

1. **Edit** the split files in `paths/` or `components/` directories
2. **Merge** paths: `npm run merge` to create `openapi.yaml` (or it runs automatically with `npm run bundle`)
3. **Bundle** with Redocly: `npm run bundle` to create `bundled.yaml` (Redocly resolves all component references)
4. **Use** `bundled.yaml` with tools that require a single OpenAPI file

## Common Responses

The API uses standardized response components for consistency:

- **401 Unauthorized** - Used when authentication is required or invalid
- **403 Forbidden** - Used when access is denied (includes IP whitelist restrictions)
- **404 NotFound** - Used when a requested resource is not found
- **422 ValidationError** - Used for validation failures with field-specific errors
- **429 TooManyRequests** - Used when rate limits are exceeded (3 minute retry window)
- **500 ServerError** - Used for internal server errors

These are defined in `components/responses.yaml` and `components/schemas.yaml` and referenced throughout the API specification using `$ref`.

## Features

- **Multi-file Organization**: OpenAPI spec split across multiple files for better maintainability
- **Standardized Responses**: Consistent error handling with 401, 403, 404, 422, 429, and 500 responses
- **CamelCase Naming**: All request/response fields use camelCase convention
- **Comprehensive Documentation**: Includes reference documentation for errors, statuses, and webhooks
- **Automated Deployment**: GitHub Actions workflow for automatic deployment to GitHub Pages
- **Redocly Integration**: Uses Redocly CLI for linting, bundling, and documentation generation

## Notes

- The `openapi.yaml` file is generated by the merge script and contains the OpenAPI structure with all paths merged
- Components (security schemes, responses, schemas) are referenced via `$ref` and resolved by Redocly during bundling
- Edit paths in the `paths/` directory and components in the `components/` directory for easier maintenance
- Both `openapi.yaml` and `bundled.yaml` files are generated and should not be edited manually
- Redocly manages the OpenAPI spec using its native multi-file support with external references
- Common responses are standardized and reused across all endpoints for consistency
- All endpoints include authentication, authorization, rate limiting, and error response documentation

